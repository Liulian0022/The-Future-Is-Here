<svg width="1250" height="720" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <marker id="arrowFilled" markerWidth="12" markerHeight="12" refX="10" refY="6" orient="auto">
      <path d="M2,2 L10,6 L2,10 L6,6 Z" fill="#546E7A" />
    </marker>
    <marker id="arrowDashed" markerWidth="12" markerHeight="12" refX="10" refY="6" orient="auto">
      <path d="M2,2 L10,6 L2,10 L6,6 Z" fill="#EF6C00" />
    </marker>
    
    <linearGradient id="gradInput" x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" stop-color="#B3E5FC"/><stop offset="100%" stop-color="#81D4FA"/></linearGradient>
    <linearGradient id="gradModel" x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" stop-color="#C8E6C9"/><stop offset="100%" stop-color="#A5D6A7"/></linearGradient>
    <linearGradient id="gradPred" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" stop-color="#FFE0B2"/><stop offset="100%" stop-color="#FFCC80"/></linearGradient>
    <linearGradient id="gradStack" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" stop-color="#E1BEE7"/><stop offset="100%" stop-color="#CE93D8"/></linearGradient>
    <linearGradient id="gradMeta" x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" stop-color="#D1C4E9"/><stop offset="100%" stop-color="#B39DDB"/></linearGradient>
    <linearGradient id="gradWeight" x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" stop-color="#B2DFDB"/><stop offset="100%" stop-color="#80CBC4"/></linearGradient>
    <linearGradient id="gradAttn" x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" stop-color="#FFF9C4"/><stop offset="100%" stop-color="#FFF59D"/></linearGradient>
    
    <style type="text/css">
      .label-txt { font-family: Arial, Helvetica, sans-serif; font-weight: bold; fill: #37474F; text-anchor: middle; }
      .sub-txt { font-family: Arial, Helvetica, sans-serif; fill: #546E7A; text-anchor: middle; font-size: 12px; }
      .math-txt { font-family: 'Times New Roman', serif; font-style: italic; fill: #37474F; text-anchor: middle; }
      .dim-txt { font-family: 'Times New Roman', serif; fill: #78909C; text-anchor: middle; font-size: 11px; }
      .op-circle { fill: #F5F5F5; stroke: #CFD8DC; stroke-width: 2; }
      .flow-line { stroke: #90A4AE; stroke-width: 2.5; fill: none; marker-end: url(#arrowFilled); }
      .attn-line { stroke: #EF6C00; stroke-width: 2; fill: none; stroke-dasharray: 5,3; marker-end: url(#arrowDashed); }
    </style>
  </defs>

  <text x="625" y="40" class="label-txt" font-size="24">上下文感知动态融合集成预测框架</text>

  <g transform="translate(50, 280)">
    <polygon points="10,10 110,10 130,30 130,90 30,90 10,70" fill="url(#gradInput)" stroke="#4FC3F7" stroke-width="1"/>
    <line x1="10" y1="70" x2="110" y2="70" stroke="#4FC3F7" />
    <line x1="110" y1="70" x2="110" y2="10" stroke="#4FC3F7" />
    <line x1="110" y1="70" x2="130" y2="90" stroke="#4FC3F7" />
    <text x="70" y="55" class="math-txt" font-size="20" font-weight="bold">X</text>
    <text x="70" y="115" class="sub-txt">历史输入序列</text>
    <text x="70" y="135" class="dim-txt">ℝⁿˣᵐ</text>
    <text x="5" y="50" class="dim-txt" transform="rotate(-90, 5, 50)">时间 n</text>
    <text x="70" y="85" class="dim-txt">特征 m</text>
  </g>

  <path d="M 140 330 L 200 330 L 200 150 L 230 150" class="flow-line"/> <path d="M 140 330 L 200 330 L 200 300 L 230 300" class="flow-line"/> <path d="M 140 330 L 200 330 L 200 450 L 230 450" class="flow-line"/> <path d="M 140 330 L 200 330 L 200 600 L 240 600" class="flow-line"/> <g transform="translate(240, 100)">
    <rect x="0" y="0" width="120" height="60" rx="6" fill="url(#gradModel)" stroke="#81C784" stroke-width="2"/>
    <text x="60" y="35" class="label-txt" font-size="14">基模型 M₁</text>
  </g>
  <g transform="translate(240, 250)">
     <text x="60" y="10" class="label-txt" font-size="18">...</text>
    <rect x="0" y="20" width="120" height="60" rx="6" fill="url(#gradModel)" stroke="#81C784" stroke-width="2"/>
    <text x="60" y="55" class="label-txt" font-size="14">基模型 Mᵢ</text>
  </g>
  <g transform="translate(240, 420)">
     <text x="60" y="10" class="label-txt" font-size="18">...</text>
    <rect x="0" y="0" width="120" height="60" rx="6" fill="url(#gradModel)" stroke="#81C784" stroke-width="2"/>
    <text x="60" y="35" class="label-txt" font-size="14">基模型 M_b</text>
    <text x="60" y="80" class="sub-txt">集合 ℳ</text>
  </g>

  <g transform="translate(250, 565)">
    <rect x="0" y="0" width="160" height="70" rx="8" fill="url(#gradAttn)" stroke="#FFF176" stroke-width="2"/>
    <text x="80" y="30" class="label-txt" font-size="14">交叉注意力</text>
    <text x="80" y="50" class="label-txt" font-size="14">感知模块</text>
    <text x="80" y="85" class="sub-txt">捕获历史依赖</text>
  </g>

  <g transform="translate(420, 100)">
    <g>
        <polygon points="0,10 80,10 100,30 100,70 20,70 0,50" fill="url(#gradPred)" stroke="#FFB74D"/>
        <line x1="0" y1="50" x2="80" y2="50" stroke="#FFB74D"/>
        <line x1="80" y1="50" x2="80" y2="10" stroke="#FFB74D"/>
        <line x1="80" y1="50" x2="100" y2="70" stroke="#FFB74D"/>
        <text x="50" y="45" class="math-txt" font-size="16" font-weight="bold">Ŷ₁</text>
        <text x="10" y="35" class="dim-txt" transform="rotate(-90, 10, 35)">T</text>
        <text x="50" y="65" class="dim-txt">c</text>
    </g>
     <g transform="translate(0, 170)">
        <text x="50" y="0" class="label-txt" font-size="18">...</text>
        <polygon points="0,10 80,10 100,30 100,70 20,70 0,50" fill="url(#gradPred)" stroke="#FFB74D"/>
        <line x1="0" y1="50" x2="80" y2="50" stroke="#FFB74D"/>
        <line x1="80" y1="50" x2="80" y2="10" stroke="#FFB74D"/>
        <line x1="80" y1="50" x2="100" y2="70" stroke="#FFB74D"/>
        <text x="50" y="45" class="math-txt" font-size="16" font-weight="bold">Ŷᵢ</text>
    </g>
     <g transform="translate(0, 320)">
         <text x="50" y="0" class="label-txt" font-size="18">...</text>
        <polygon points="0,10 80,10 100,30 100,70 20,70 0,50" fill="url(#gradPred)" stroke="#FFB74D"/>
        <line x1="0" y1="50" x2="80" y2="50" stroke="#FFB74D"/>
        <line x1="80" y1="50" x2="80" y2="10" stroke="#FFB74D"/>
        <line x1="80" y1="50" x2="100" y2="70" stroke="#FFB74D"/>
        <text x="50" y="45" class="math-txt" font-size="16" font-weight="bold">Ŷ_b</text>
        <text x="50" y="85" class="dim-txt">ℝᵀˣᶜ</text>
    </g>
  </g>

  <path d="M 360 130 L 410 130" class="flow-line"/>
  <path d="M 360 300 L 410 300" class="flow-line"/>
  <path d="M 360 450 L 410 450" class="flow-line"/>

  <g transform="translate(570, 260)">
    <circle cx="30" cy="30" r="30" class="op-circle" fill="#E1BEE7" stroke="#BA68C8"/>
    <text x="30" y="35" class="label-txt" font-size="12">Concat</text>
    <text x="30" y="75" class="sub-txt">特征拼接</text>
  </g>

  <path d="M 520 135 L 550 135 L 550 270 L 565 270" class="flow-line"/>
  <path d="M 520 305 L 550 305 L 550 290 L 565 290" class="flow-line"/>
  <path d="M 520 455 L 550 455 L 550 310 L 565 310" class="flow-line"/>

  <g transform="translate(650, 230)">
    <polygon points="0,10 120,10 140,30 140,80 20,80 0,60" fill="url(#gradStack)" stroke="#BA68C8"/>
    <line x1="0" y1="60" x2="120" y2="60" stroke="#BA68C8"/>
    <line x1="120" y1="60" x2="120" y2="10" stroke="#BA68C8"/>
    <line x1="120" y1="60" x2="140" y2="80" stroke="#BA68C8"/>
    <text x="70" y="50" class="math-txt" font-size="20" font-weight="bold">F</text>
    <text x="70" y="100" class="sub-txt">堆叠特征张量</text>
    <text x="70" y="120" class="dim-txt">ℝᵀˣ⁽ᵇ⋅ᶜ⁾</text>
    <text x="5" y="40" class="dim-txt" transform="rotate(-90, 5, 40)">T</text>
    <text x="70" y="75" class="dim-txt">b ⋅ c</text>
  </g>
  <path d="M 630 290 L 645 290" class="flow-line"/>

  <g transform="translate(650, 450)">
    <rect x="0" y="0" width="140" height="80" rx="8" fill="url(#gradMeta)" stroke="#9575CD" stroke-width="2"/>
    <text x="70" y="35" class="label-txt" font-size="16">元学习器 G</text>
    <text x="70" y="60" class="sub-txt">动态权重生成</text>
  </g>

  <path d="M 720 330 L 720 440" class="flow-line"/> <path d="M 410 600 L 720 600 L 720 540" class="attn-line"/> <text x="560" y="590" class="sub-txt" fill="#EF6C00">Attention (条件信息)</text>

  <g transform="translate(850, 440)">
    <polygon points="10,10 90,10 110,30 110,130 30,130 10,110" fill="url(#gradWeight)" stroke="#4DB6AC"/>
    <line x1="10" y1="110" x2="90" y2="110" stroke="#4DB6AC"/>
    <line x1="90" y1="110" x2="90" y2="10" stroke="#4DB6AC"/>
    <line x1="90" y1="110" x2="110" y2="130" stroke="#4DB6AC"/>
    <text x="60" y="75" class="math-txt" font-size="22" font-weight="bold">W</text>
    <text x="60" y="150" class="sub-txt">动态权重分布</text>
    <text x="60" y="170" class="dim-txt">ℝᵀˣᵇ (ΣWₜ = 1)</text>
     <text x="5" y="70" class="dim-txt" transform="rotate(-90, 5, 70)">预测步长 T</text>
    <text x="60" y="125" class="dim-txt">模型 b</text>
  </g>
  <path d="M 790 490 L 840 490" class="flow-line"/> <g transform="translate(1000, 135)">
    <circle cx="25" cy="25" r="20" class="op-circle" fill="#FFE0B2" stroke="#FFB74D"/>
    <text x="25" y="32" class="label-txt" font-size="20">⊙</text>
  </g>
   <g transform="translate(1000, 305)">
    <text x="25" y="10" class="label-txt" font-size="20">...</text>
    <circle cx="25" cy="25" r="20" class="op-circle" fill="#FFE0B2" stroke="#FFB74D"/>
    <text x="25" y="32" class="label-txt" font-size="20">⊙</text>
  </g>
  <g transform="translate(1000, 455)">
    <text x="25" y="10" class="label-txt" font-size="20">...</text>
    <circle cx="25" cy="25" r="20" class="op-circle" fill="#FFE0B2" stroke="#FFB74D"/>
    <text x="25" y="32" class="label-txt" font-size="20">⊙</text>
  </g>

  <path d="M 520 135 L 990 160" class="flow-line" stroke-dasharray="5,5" opacity="0.6"/>
  <path d="M 520 305 L 990 330" class="flow-line" stroke-dasharray="5,5" opacity="0.6"/>
  <path d="M 520 455 L 990 480" class="flow-line" stroke-dasharray="5,5" opacity="0.6"/>

  <path d="M 900 440 L 900 110 L 1025 110 L 1025 130" class="flow-line" stroke="#4DB6AC"/>
  <text x="960" y="105" class="dim-txt">W:,₁</text>
  
  <path d="M 930 440 L 930 280 L 1025 280 L 1025 300" class="flow-line" stroke="#4DB6AC"/>
   <text x="970" y="275" class="dim-txt">W:,ᵢ</text>

  <path d="M 960 500 L 1025 500 L 1025 450" class="flow-line" stroke="#4DB6AC"/>
   <text x="990" y="520" class="dim-txt">W:,b</text>

  <g transform="translate(1100, 280)">
    <circle cx="30" cy="30" r="28" class="op-circle" fill="#C8E6C9" stroke="#81C784"/>
    <text x="30" y="38" class="label-txt" font-size="24">Σ</text>
  </g>

  <path d="M 1050 160 L 1080 160 L 1080 290 L 1095 290" class="flow-line"/>
  <path d="M 1050 330 L 1080 330 L 1080 310 L 1095 310" class="flow-line"/>
  <path d="M 1050 480 L 1080 480 L 1080 330 L 1095 330" class="flow-line"/>


  <g transform="translate(1150, 150)">
    <rect x="0" y="0" width="90" height="50" rx="6" fill="#A5D6A7" stroke="#388E3C" stroke-width="2"/>
    <text x="45" y="30" class="math-txt" font-size="18" font-weight="bold" fill="#1B5E20">Ŷ</text>
    <text x="45" y="65" class="sub-txt">最终集成预测</text>
  </g>
   <path d="M 1130 280 L 1130 175 L 1145 175" class="flow-line"/>

  <g transform="translate(1150, 50)">
    <rect x="0" y="0" width="90" height="50" rx="6" fill="#F5F5F5" stroke="#B0BEC5" stroke-width="2" stroke-dasharray="4,4"/>
    <text x="45" y="30" class="math-txt" font-size="18" font-weight="bold" fill="#455A64">Y</text>
    <text x="45" y="65" class="sub-txt">真实序列(GT)</text>
  </g>

  <g transform="translate(1050, 50)">
    <circle cx="25" cy="25" r="25" fill="#FFCDD2" stroke="#E57373" stroke-width="2"/>
    <text x="25" y="25" class="label-txt" font-size="14" fill="#C62828">Loss ℒ</text>
    <text x="25" y="40" class="sub-txt" font-size="10" fill="#C62828">目标优化</text>
  </g>

  <path d="M 1150 75 L 1080 75" class="flow-line" stroke="#E57373" marker-end="url(#arrowFilled)"/> <path d="M 1150 175 L 1110 175 L 1110 100 L 1070 85" class="flow-line" stroke="#E57373" marker-end="url(#arrowFilled)"/> <g transform="translate(50, 660)">
    <rect x="0" y="0" width="420" height="50" fill="none" stroke="#CFD8DC" rx="4"/>
    <text x="10" y="20" class="label-txt" font-size="12">图例:</text>
    
    <line x1="50" y1="15" x2="80" y2="15" class="flow-line"/>
    <text x="90" y="20" class="sub-txt" text-anchor="start">数据流向</text>

    <line x1="160" y1="15" x2="190" y2="15" class="attn-line"/>
    <text x="200" y="20" class="sub-txt" text-anchor="start">条件/注意力信息</text>
    
    <circle cx="310" cy="15" r="8" fill="#FFE0B2" stroke="#FFB74D"/>
    <text x="310" y="20" class="label-txt" font-size="12">⊙</text>
    <text x="325" y="20" class="sub-txt" text-anchor="start">逐时间步加权 (Hadamard积)</text>

    <text x="10" y="40" class="dim-txt" text-anchor="start">注: 3D块状图用于直观展示张量的维度变化 (如 T=时间步, c=特征/目标维度, b=模型数)。</text>
  </g>

</svg>